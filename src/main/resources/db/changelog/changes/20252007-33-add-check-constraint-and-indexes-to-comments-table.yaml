databaseChangeLog:
  # =====================================================================
  # 33-QADAM: "comments" JADVALIGA MAXSUS CHEKLOV VA INDEKSLAR QO'SHISH
  # =====================================================================
  - changeSet:
      id: 20252007-33-add-check-constraint-and-indexes-to-comments-table
      author: Eldor04
      comment: "Step 33: Add CHECK constraint for polymorphism and performance indexes"
      changes:
        - addCheckConstraint:
            constraintName: chk_comment_polymorphic_owner
            tableName: comments
            constraintBody: "((course_id IS NOT NULL AND lesson_id IS NULL) OR (course_id IS NULL AND lesson_id IS NOT NULL))"
            remarks: "Ensures a comment belongs to either a course or a lesson, but not both."
        - createIndex:
            indexName: idx_comments_on_user_id
            tableName: comments
            columns:
              - column:
                  name: user_id
        - createIndex:
            indexName: idx_comments_on_course_id
            tableName: comments
            columns:
              - column:
                  name: course_id
        - createIndex:
            indexName: idx_comments_on_lesson_id
            tableName: comments
            columns:
              - column:
                  name: lesson_id
        - createIndex:
            indexName: idx_comments_on_parent_id
            tableName: comments
            columns:
              - column:
                  name: parent_id